"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _mongoose=_interopRequireDefault(require("mongoose"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=c.apply(e,i);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var defaultKey="sql.projectionState",ProjectionStateSchema=new _mongoose.default.Schema({id:String,bookmark:Number}),activeDataKey="sql.activeKey",ActiveDataSchema=new _mongoose.default.Schema({id:String,key:String}),ProjectionState=function e(){var o=this;_classCallCheck(this,e),_defineProperty(this,"getActiveKey",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ActiveDataModel.findOne({id:activeDataKey});case 2:return(null==(t=e.sent)?void 0:t.key)&&(o.projectionStateKey="".concat(defaultKey,".").concat(null==t?void 0:t.key),o.ProjectionStateModel=_mongoose.default.model(o.projectionStateKey,ProjectionStateSchema)),e.abrupt("return",(null==t?void 0:t.key)||"");case 5:case"end":return e.stop()}},e)}))),_defineProperty(this,"setKey",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ActiveDataModel.findOne({id:activeDataKey});case 2:return(n=e.sent)||((n=new o.ActiveDataModel).id=activeDataKey),n.key=t,e.next=7,n.save();case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),_defineProperty(this,"bookmark",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ProjectionStateModel.findOne({id:defaultKey});case 2:if((t=e.sent)||((t=new o.ProjectionStateModel).id=defaultKey),t.bookmark){e.next=8;break}return t.bookmark=0,e.next=8,t.save();case 8:return e.abrupt("return",t.bookmark);case 9:case"end":return e.stop()}},e)}))),_defineProperty(this,"setBookmark",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ProjectionStateModel.findOne({id:defaultKey});case 2:return(n=e.sent)||((n=new o.ProjectionStateModel).id=defaultKey),n.bookmark=t,e.next=7,n.save();case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),_defineProperty(this,"reset",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(defaultKey,".").concat(t),r=o.ProjectionStateModel,o.ProjectionStateModel=_mongoose.default.model(n,ProjectionStateSchema),e.next=5,o.ProjectionStateModel.findOneAndUpdate({id:defaultKey},{bookmark:0},{upsert:!0});case 5:r.collection.drop(),o.projectionStateKey=n,o.setKey(t);case 8:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),this.projectionStateKey=defaultKey,this.ProjectionStateModel=_mongoose.default.model(defaultKey,ProjectionStateSchema),this.ActiveDataModel=_mongoose.default.model(activeDataKey,ActiveDataSchema)};exports.default=ProjectionState;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNxbFByb2plY3Rpb25TdGF0ZS5qcyJdLCJuYW1lcyI6WyJfbW9uZ29vc2UiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImRlZmF1bHRLZXkiLCJQcm9qZWN0aW9uU3RhdGVTY2hlbWEiLCJtb25nb29zZSIsIlNjaGVtYSIsImlkIiwiU3RyaW5nIiwiYm9va21hcmsiLCJOdW1iZXIiLCJhY3RpdmVEYXRhS2V5IiwiQWN0aXZlRGF0YVNjaGVtYSIsImtleSIsIlByb2plY3Rpb25TdGF0ZSIsIl90aGlzIiwidGhpcyIsIl9jbGFzc0NhbGxDaGVjayIsIl9kZWZpbmVQcm9wZXJ0eSIsIl9hc3luY1RvR2VuZXJhdG9yIiwicmVnZW5lcmF0b3JSdW50aW1lIiwibWFyayIsIkFjdGl2ZURhdGFNb2RlbCIsImZpbmRPbmUiLCJzdGF0ZSIsInByb2plY3Rpb25TdGF0ZUtleSIsIl9yZWYyIiwiYWN0aXZlS2V5Iiwic2F2ZSIsIl94IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfY2FsbGVlMyIsIndyYXAiLCJfY29udGV4dDMiLCJwcmV2IiwibmV4dCIsIlByb2plY3Rpb25TdGF0ZU1vZGVsIiwic2VudCIsImFicnVwdCIsInN0b3AiLCJfcmVmNCIsIl9jYWxsZWU0IiwiX2NvbnRleHQ0IiwiX3gyIiwiX3JlZjUiLCJfY2FsbGVlNSIsIm5ld1Byb2plY3Rpb25TdGF0ZUtleSIsIm9sZE1vZGVsIiwiX2NvbnRleHQ1IiwiY29uY2F0IiwibW9kZWwiLCJmaW5kT25lQW5kVXBkYXRlIiwidXBzZXJ0IiwiY29sbGVjdGlvbiIsImRyb3AiLCJfeDMiXSwibWFwcGluZ3MiOiIyRkFBQSxJQUFBQSxVQUFBQyx1QkFBQUMsUUFBQSxvc0JBRUEsSUFBTUMsV0FBYSxzQkFDYkMsc0JBQXdCLElBQUlDLFVBQUFBLFFBQVNDLE9BQU8sQ0FDNUNDLEdBQUlDLE9BQ0pDLFNBQVVDLFNBR1pDLGNBQWdCLGdCQUNkQyxpQkFBbUIsSUFBSVAsVUFBQUEsUUFBU0MsT0FBTyxD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a0MsRUFBQVAsS0FBQSxFQVVOWixFQUFBSSxPQVZNLEtBQUEsRUFBQSxJQUFBLE1BQUEsT0FBQWUsRUFBQUgsU0FBQUUsTUFMRCxPQUFBLFNBQUFFLEdBQUEsT0FBQUgsRUFBQVgsTUFBQWQsS0FBQWUsWUFBQSxJQUFBYixnQkFBQUYsS0FBQSxRQUFBLFdBQUEsSUFBQTZCLEVBQUExQixrQkFBQUMsbUJBQUFDLEtBZUwsU0FBQXlCLEVBQUFqQyxHQUFBLElBQUFrQyxFQUFBQyxFQUFBLE9BQUE1QixtQkFBQWEsS0FBQSxTQUFBZ0IsR0FBQSxPQUFBLE9BQUFBLEVBQUFkLEtBQUFjLEVBQUFiLE1BQUEsS0FBQSxFQUFBLE9BQUFXLEVBQUEsR0FBQUcsT0FBQS9DLFdBQUEsS0FBQStDLE9BQUFyQyxHQUUwQ04sRUFBSUksRUFBQUEscUJBb0RyREksRUFBS3NCLHFCQUF1QmhDLFVBQUFBLFFBQVM4QyxNQUFNSixFQUF1QjNDLHVCQXREM0Q2QyxFQUFBYixLQUFBLEVBeUREckIsRUFBS3NCLHFCQXJEWGUsaUJBQUEsQ0FBWTdDLEdBQUFKLFlBQUEsQ0FBQU0sU0FBQSxHQUFBLENBQUE0QyxRQUFBLElBSkwsS0FBQSxFQTREUEwsRUFBU00sV0FBV0MsT0FwRG5CeEMsRUFBQVUsbUJBQUFzQixFQUVEdkIsRUFBQUEsT0FBQUEsR0FWTyxLQUFBLEVBQUEsSUFBQSxNQUFBLE9BQUF5QixFQUFBVCxTQUFBTSxNQWZLLE9BQUEsU0FBQVUsR0FBQSxPQUFBWCxFQUFBZixNQUFBZCxLQUFBZSxZQUFBLElBQ1pmLEtBQUtTLG1CQUFxQnRCLFdBQzFCYSxLQUFLcUIscUJBQXVCaEMsVUFBQUEsUUFBUzhDLE1BQU1oRCxXQUFZQyx1QkFDdkRZLEtBQUtNLGdCQUFrQmpCLFVBQUFBLFFBQVM4QyxNQUFNeEMsY0FBZUMiLCJmaWxlIjoic3FsUHJvamVjdGlvblN0YXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJztcblxuY29uc3QgZGVmYXVsdEtleSA9ICdzcWwucHJvamVjdGlvblN0YXRlJztcbmNvbnN0IFByb2plY3Rpb25TdGF0ZVNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICAgICAgaWQ6IFN0cmluZyxcbiAgICAgIGJvb2ttYXJrOiBOdW1iZXJcbiAgfSk7XG5cbmxldCBhY3RpdmVEYXRhS2V5ID0gJ3NxbC5hY3RpdmVLZXknO1xuY29uc3QgQWN0aXZlRGF0YVNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICAgIGlkOiBTdHJpbmcsXG4gICAga2V5OiBTdHJpbmdcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQcm9qZWN0aW9uU3RhdGUge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnByb2plY3Rpb25TdGF0ZUtleSA9IGRlZmF1bHRLZXk7XG4gICAgdGhpcy5Qcm9qZWN0aW9uU3RhdGVNb2RlbCA9IG1vbmdvb3NlLm1vZGVsKGRlZmF1bHRLZXksIFByb2plY3Rpb25TdGF0ZVNjaGVtYSk7XG4gICAgdGhpcy5BY3RpdmVEYXRhTW9kZWwgPSBtb25nb29zZS5tb2RlbChhY3RpdmVEYXRhS2V5LCBBY3RpdmVEYXRhU2NoZW1hKTtcbiAgfVxuICBnZXRBY3RpdmVLZXkgPSBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgc3RhdGUgPSBhd2FpdCB0aGlzLkFjdGl2ZURhdGFNb2RlbC5maW5kT25lKHsgaWQ6IGFjdGl2ZURhdGFLZXkgfSk7XG4gICAgICAvLyBjaGFuZ2Ugb3ZlciBQcm9qZWN0aW9uU3RhdGUga2V5IGFzIHdlbGwuXG4gICAgICBpZiAoc3RhdGU/LmtleSkge1xuICAgICAgICB0aGlzLnByb2plY3Rpb25TdGF0ZUtleSA9IGAke2RlZmF1bHRLZXl9LiR7c3RhdGU/LmtleX1gO1xuICAgICAgICB0aGlzLlByb2plY3Rpb25TdGF0ZU1vZGVsID0gbW9uZ29vc2UubW9kZWwodGhpcy5wcm9qZWN0aW9uU3RhdGVLZXksIFByb2plY3Rpb25TdGF0ZVNjaGVtYSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RhdGU/LmtleSB8fCAnJztcbiAgfVxuXG4gIHNldEtleSA9IGFzeW5jIGFjdGl2ZUtleSA9PiB7XG4gICAgLy8gdGhpcyBpcyB1c2VkIHRvIHN0b3JlIHRoZSBVVUlEIGtleSB0aGF0IGlzIHBvc3RmaXhlZCB0byBldmVyeSBzdG9yZSB0byBoYW5kbGUgcmVzZXQgc3dhcHNcbiAgICBsZXQgc3RhdGUgPSBhd2FpdCB0aGlzLkFjdGl2ZURhdGFNb2RlbC5maW5kT25lKHsgaWQ6IGFjdGl2ZURhdGFLZXkgfSk7XG5cbiAgICBpZiAoIXN0YXRlKSB7XG4gICAgICBzdGF0ZSA9IG5ldyB0aGlzLkFjdGl2ZURhdGFNb2RlbCgpO1xuICAgICAgLy8gYWx3YXlzIHNldCB0aGUgaWQgdG8gdGhlIGFjdGl2ZURhdGFLZXksIHdlIG9ubHkgaGF2ZSAxIGVudHJ5IGluIHRoaXMgbW9kZWwgc28gaXQgd29ya3NcbiAgICAgIHN0YXRlLmlkID0gYWN0aXZlRGF0YUtleTtcbiAgICB9XG5cbiAgICBzdGF0ZS5rZXkgPSBhY3RpdmVLZXk7XG4gICAgYXdhaXQgc3RhdGUuc2F2ZSgpO1xuICB9XG5cbiAgYm9va21hcmsgPSBhc3luYyAoKSA9PiB7XG4gICAgLy8gT2sgdGhpcyBpcyBjb25mdXNpbmcsIHNvIGxldHMgZXhwbGFpbiBpdC4gIFdlIHNpbXBseSBuZWVkIGEgc2luZ2xlIGVudHJ5IGluIGEgY29sbGVjdGlvbi5cbiAgICAvLyB0aHVzIHdlIGp1c3QgdGFnIHRoZSBpZCBhcyB0aGUgZGVmYXVsdEtleSBhbmQgc2VhcmNoIHRvIHNlZSBpZiBpdCBleGlzdHMuICBZb3UgbWlnaHQgYmVcbiAgICAvLyB0ZW1wdGVkIHRvIHVzZSB0aGlzLmtleSwgYnV0IHRoYXQncyBhIG1pc3Rha2UgYXMgdGhhdCdzIHdoYXQgY29udHJvbHMgdGhlIG1vZGVsLiAgd2UgYWx3YXlzXG4gICAgLy8gd2FudCB0byBzdG9yZSB0aGUgdmFsdWUgb2Ygb2YgYm9va21hcmtzIChhbmQgcHJvamVjdGlvbiBzdGF0ZSkgaW4gdGhlIGRlZmF1bHRLZXlcbiAgICB2YXIgc3RhdGUgPSBhd2FpdCB0aGlzLlByb2plY3Rpb25TdGF0ZU1vZGVsLmZpbmRPbmUoeyBpZDogZGVmYXVsdEtleSB9KTtcblxuICAgIGlmICghc3RhdGUpIHtcbiAgICAgIHN0YXRlID0gbmV3IHRoaXMuUHJvamVjdGlvblN0YXRlTW9kZWwoKTtcbiAgICAgIC8vIHJlbWVtYmVyIGFsd2F5cyB1c2UgZGVmYXVsdCBLZXkgZm9yIHN0b3JpbmcgdGhlIHZhbHVlIGluIHRoZSBjb2xsZWN0aW9uXG4gICAgICBzdGF0ZS5pZCA9IGRlZmF1bHRLZXk7XG4gICAgfVxuXG4gICAgaWYgKCFzdGF0ZS5ib29rbWFyaykge1xuICAgICAgc3RhdGUuYm9va21hcmsgPSAwO1xuICAgICAgYXdhaXQgc3RhdGUuc2F2ZSgpO1xuICAgIH1cblxuICAgIHJldHVybiBzdGF0ZS5ib29rbWFyaztcbiAgfVxuXG4gIHNldEJvb2ttYXJrID0gYXN5bmMgYm9va21hcmsgPT4ge1xuICAgIGxldCBzdGF0ZSA9IGF3YWl0IHRoaXMuUHJvamVjdGlvblN0YXRlTW9kZWwuZmluZE9uZSh7IGlkOiBkZWZhdWx0S2V5IH0pO1xuXG4gICAgaWYgKCFzdGF0ZSkge1xuICAgICAgc3RhdGUgPSBuZXcgdGhpcy5Qcm9qZWN0aW9uU3RhdGVNb2RlbCgpO1xuICAgICAgLy8gcmVtZW1iZXIgYWx3YXlzIHVzZSBkZWZhdWx0IEtleSBmb3Igc3RvcmluZyB0aGUgdmFsdWUgaW4gdGhlIGNvbGxlY3Rpb25cbiAgICAgIHN0YXRlLmlkID0gZGVmYXVsdEtleTtcbiAgICB9XG5cbiAgICBzdGF0ZS5ib29rbWFyayA9IGJvb2ttYXJrO1xuICAgIGF3YWl0IHN0YXRlLnNhdmUoKTtcbiAgfVxuXG4gIHJlc2V0ID0gYXN5bmMga2V5ID0+IHtcbiAgICAvLyBrZXkgY29taW5nIGluIGlzIGEgVVVJRCwgbm90IHRoZSBmdWxsIHByZWZpeCBrZXkgZm9yIHRoZSBwcm9qZWN0aW9uIGJvb2ttYXJrIHN0b3JlXG4gICAgY29uc3QgbmV3UHJvamVjdGlvblN0YXRlS2V5ID0gYCR7ZGVmYXVsdEtleX0uJHtrZXl9YDtcbiAgICAvLyBzdG9yZSB0aGUgb2xkIG1vZGVsIHNvIHdlIGNhbiBkZWxldGUgaXQgYWZ0ZXIgd2UgaGF2ZSB1cGRhdGVkIHRoZSBuZXcgbW9kZWxcbiAgICBjb25zdCBvbGRNb2RlbCA9IHRoaXMuUHJvamVjdGlvblN0YXRlTW9kZWw7XG4gICAgLy8gd2UgdXBkYXRlIHRoZSBzY2hlbWEgdG8gcG9pbnQgdG8gdGhlIG5ldyBrZXlcbiAgICB0aGlzLlByb2plY3Rpb25TdGF0ZU1vZGVsID0gbW9uZ29vc2UubW9kZWwobmV3UHJvamVjdGlvblN0YXRlS2V5LCBQcm9qZWN0aW9uU3RhdGVTY2hlbWEpO1xuICAgIC8vIGNoYW5nZSBtb2RlbCBrZXksIHdoaWNoIGNyZWF0ZXMgYSBuZXcgY29sbGVjdGlvbiBpbiBkYi4gV2hpbGUgdGhpcyBpcyBhIC5maW5kT25lQW5kVXBkYXRlXG4gICAgLy8gaXQgd2lsbCBuZXZlciBmaW5kIGFueXRoaW5nIHNpbmNlIHRoaXMgaXMgYSBuZXcgbW9kZWwsIHRodXMgaXQgd2lsbCBjcmVhdGUgaXQgZXZlcnkgdGltZVxuICAgIGF3YWl0IHRoaXMuUHJvamVjdGlvblN0YXRlTW9kZWxcbiAgICAgIC5maW5kT25lQW5kVXBkYXRlKHsgaWQ6IGRlZmF1bHRLZXkgfSwgeyBib29rbWFyazogMCB9LCB7IHVwc2VydDogdHJ1ZSB9KTtcblxuICAgIG9sZE1vZGVsLmNvbGxlY3Rpb24uZHJvcCgpO1xuICAgIC8vIHVzZSB0aGUgbmV3IHByb2plY3Rpb25TdGF0ZUtleSBldmVyeXdoZXJlLlxuICAgIHRoaXMucHJvamVjdGlvblN0YXRlS2V5ID0gbmV3UHJvamVjdGlvblN0YXRlS2V5O1xuICAgIC8vIHNhdmUgdGhlIGtleSBpbiB0aGUgZGF0YWJhc2Ugc28gd2UgZG9uJ3QgaGF2ZSB0byByZWJ1aWxkIHRoZSBkYXRhIG9uIHN0YXJ0dXBcbiAgICB0aGlzLnNldEtleShrZXkpO1xuICB9XG59XG4iXX0=
