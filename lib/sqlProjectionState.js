"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _mongoose=_interopRequireDefault(require("mongoose"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=c.apply(e,i);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var defaultKey="sql.projectionState",ProjectionStateSchema=new _mongoose.default.Schema({id:String,bookmark:Number}),activeDataKey="sql.activeKey",ActiveDataSchema=new _mongoose.default.Schema({id:String,key:String}),ProjectionState=function e(){var o=this;_classCallCheck(this,e),_defineProperty(this,"getActiveKey",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ActiveDataModel.findOne({id:activeDataKey});case 2:return null!=(t=e.sent)&&t.key&&(o.projectionStateKey="".concat(defaultKey,".").concat(null==t?void 0:t.key),o.ProjectionStateModel=_mongoose.default.model(o.projectionStateKey,ProjectionStateSchema)),e.abrupt("return",(null==t?void 0:t.key)||"");case 5:case"end":return e.stop()}},e)}))),_defineProperty(this,"setKey",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ActiveDataModel.findOne({id:activeDataKey});case 2:return(n=e.sent)||((n=new o.ActiveDataModel).id=activeDataKey),n.key=t,e.next=7,n.save();case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),_defineProperty(this,"bookmark",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ProjectionStateModel.findOne({id:defaultKey});case 2:if((t=e.sent)||((t=new o.ProjectionStateModel).id=defaultKey),t.bookmark){e.next=8;break}return t.bookmark=0,e.next=8,t.save();case 8:return e.abrupt("return",t.bookmark);case 9:case"end":return e.stop()}},e)}))),_defineProperty(this,"setBookmark",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ProjectionStateModel.findOne({id:defaultKey});case 2:return(n=e.sent)||((n=new o.ProjectionStateModel).id=defaultKey),n.bookmark=t,e.next=7,n.save();case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),_defineProperty(this,"reset",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(defaultKey,".").concat(t),r=o.ProjectionStateModel,o.ProjectionStateModel=_mongoose.default.model(n,ProjectionStateSchema),e.next=5,o.ProjectionStateModel.findOneAndUpdate({id:defaultKey},{bookmark:0},{upsert:!0});case 5:r.collection.drop(),o.projectionStateKey=n,o.setKey(t);case 8:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),this.projectionStateKey=defaultKey,this.ProjectionStateModel=_mongoose.default.model(defaultKey,ProjectionStateSchema),this.ActiveDataModel=_mongoose.default.model(activeDataKey,ActiveDataSchema)};exports.default=ProjectionState;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNxbFByb2plY3Rpb25TdGF0ZS5qcyJdLCJuYW1lcyI6WyJfbW9uZ29vc2UiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImRlZmF1bHRLZXkiLCJQcm9qZWN0aW9uU3RhdGVTY2hlbWEiLCJtb25nb29zZSIsIlNjaGVtYSIsImlkIiwiU3RyaW5nIiwiYm9va21hcmsiLCJOdW1iZXIiLCJhY3RpdmVEYXRhS2V5IiwiQWN0aXZlRGF0YVNjaGVtYSIsImtleSIsIlByb2plY3Rpb25TdGF0ZSIsIl90aGlzIiwidGhpcyIsIl9jbGFzc0NhbGxDaGVjayIsIl9kZWZpbmVQcm9wZXJ0eSIsIl9hc3luY1RvR2VuZXJhdG9yIiwicmVnZW5lcmF0b3JSdW50aW1lIiwibWFyayIsIkFjdGl2ZURhdGFNb2RlbCIsImZpbmRPbmUiLCJzdGF0ZSIsInByb2plY3Rpb25TdGF0ZUtleSIsIl9yZWYyIiwiYWN0aXZlS2V5Iiwic2F2ZSIsIl94IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfY2FsbGVlMyIsIndyYXAiLCJfY29udGV4dDMiLCJwcmV2IiwibmV4dCIsIlByb2plY3Rpb25TdGF0ZU1vZGVsIiwic2VudCIsImFicnVwdCIsInN0b3AiLCJfcmVmNCIsIl9jYWxsZWU0IiwiX2NvbnRleHQ0IiwiX3gyIiwiX3JlZjUiLCJfY2FsbGVlNSIsIm5ld1Byb2plY3Rpb25TdGF0ZUtleSIsIm9sZE1vZGVsIiwiX2NvbnRleHQ1IiwiY29uY2F0IiwibW9kZWwiLCJmaW5kT25lQW5kVXBkYXRlIiwidXBzZXJ0IiwiY29sbGVjdGlvbiIsImRyb3AiLCJfeDMiXSwibWFwcGluZ3MiOiIyRkFBQSxJQUFBQSxVQUFBQyx1QkFBQUMsUUFBQSxvc0JBRUEsSUFBTUMsV0FBYSxzQkFDYkMsc0JBQXdCLElBQUlDLFVBQUFBLFFBQVNDLE9BQU8sQ0FDNUNDLEdBQUlDLE9BQ0pDLFNBQVVDLFNBR1pDLGNBQWdCLGdCQUNkQyxpQkFBbUIsSUFBSVAsVUFBQUEsUUFBU0MsT0FBTyxD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QUFQLEtBQUEsRUFVTlosRUFBQUksT0FWTSxLQUFBLEVBQUEsSUFBQSxNQUFBLE9BQUFlLEVBQUFILFNBQUFFLE1BTEQsT0FBQSxTQUFBRSxHQUFBLE9BQUFILEVBQUFYLE1BQUFkLEtBQUFlLFlBQUEsSUFBQWIsZ0JBQUFGLEtBQUEsUUFBQSxXQUFBLElBQUE2QixFQUFBMUIsa0JBQUFDLG1CQUFBQyxLQWVMLFNBQUF5QixFQUFBakMsR0FBQSxJQUFBa0MsRUFBQUMsRUFBQSxPQUFBNUIsbUJBQUFhLEtBQUEsU0FBQWdCLEdBQUEsT0FBQSxPQUFBQSxFQUFBZCxLQUFBYyxFQUFBYixNQUFBLEtBQUEsRUFBQSxPQUFBVyxFQUFBLEdBQUFHLE9BQUEvQyxXQUFBLEtBQUErQyxPQUFBckMsR0FFMENOLEVBQUlJLEVBQUFBLHFCQW9EckRJLEVBQUtzQixxQkFBdUJoQyxVQUFBQSxRQUFTOEMsTUFBTUosRUFBdUIzQyx1QkF0RDNENkMsRUFBQWIsS0FBQSxFQXlERHJCLEVBQUtzQixxQkFyRFhlLGlCQUFBLENBQVk3QyxHQUFBSixZQUFBLENBQUFNLFNBQUEsR0FBQSxDQUFBNEMsUUFBQSxJQUpMLEtBQUEsRUE0RFBMLEVBQVNNLFdBQVdDLE9BcERuQnhDLEVBQUFVLG1CQUFBc0IsRUFFRHZCLEVBQUFBLE9BQUFBLEdBVk8sS0FBQSxFQUFBLElBQUEsTUFBQSxPQUFBeUIsRUFBQVQsU0FBQU0sTUFmSyxPQUFBLFNBQUFVLEdBQUEsT0FBQVgsRUFBQWYsTUFBQWQsS0FBQWUsWUFBQSxJQUNaZixLQUFLUyxtQkFBcUJ0QixXQUMxQmEsS0FBS3FCLHFCQUF1QmhDLFVBQUFBLFFBQVM4QyxNQUFNaEQsV0FBWUMsdUJBQ3ZEWSxLQUFLTSxnQkFBa0JqQixVQUFBQSxRQUFTOEMsTUFBTXhDLGNBQWVDIiwiZmlsZSI6InNxbFByb2plY3Rpb25TdGF0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSBmcm9tICdtb25nb29zZSc7XG5cbmNvbnN0IGRlZmF1bHRLZXkgPSAnc3FsLnByb2plY3Rpb25TdGF0ZSc7XG5jb25zdCBQcm9qZWN0aW9uU3RhdGVTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgICAgIGlkOiBTdHJpbmcsXG4gICAgICBib29rbWFyazogTnVtYmVyXG4gIH0pO1xuXG5sZXQgYWN0aXZlRGF0YUtleSA9ICdzcWwuYWN0aXZlS2V5JztcbmNvbnN0IEFjdGl2ZURhdGFTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgICBpZDogU3RyaW5nLFxuICAgIGtleTogU3RyaW5nXG59KTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvamVjdGlvblN0YXRlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5wcm9qZWN0aW9uU3RhdGVLZXkgPSBkZWZhdWx0S2V5O1xuICAgIHRoaXMuUHJvamVjdGlvblN0YXRlTW9kZWwgPSBtb25nb29zZS5tb2RlbChkZWZhdWx0S2V5LCBQcm9qZWN0aW9uU3RhdGVTY2hlbWEpO1xuICAgIHRoaXMuQWN0aXZlRGF0YU1vZGVsID0gbW9uZ29vc2UubW9kZWwoYWN0aXZlRGF0YUtleSwgQWN0aXZlRGF0YVNjaGVtYSk7XG4gIH1cbiAgZ2V0QWN0aXZlS2V5ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHN0YXRlID0gYXdhaXQgdGhpcy5BY3RpdmVEYXRhTW9kZWwuZmluZE9uZSh7IGlkOiBhY3RpdmVEYXRhS2V5IH0pO1xuICAgICAgLy8gY2hhbmdlIG92ZXIgUHJvamVjdGlvblN0YXRlIGtleSBhcyB3ZWxsLlxuICAgICAgaWYgKHN0YXRlPy5rZXkpIHtcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9uU3RhdGVLZXkgPSBgJHtkZWZhdWx0S2V5fS4ke3N0YXRlPy5rZXl9YDtcbiAgICAgICAgdGhpcy5Qcm9qZWN0aW9uU3RhdGVNb2RlbCA9IG1vbmdvb3NlLm1vZGVsKHRoaXMucHJvamVjdGlvblN0YXRlS2V5LCBQcm9qZWN0aW9uU3RhdGVTY2hlbWEpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0YXRlPy5rZXkgfHwgJyc7XG4gIH1cblxuICBzZXRLZXkgPSBhc3luYyBhY3RpdmVLZXkgPT4ge1xuICAgIC8vIHRoaXMgaXMgdXNlZCB0byBzdG9yZSB0aGUgVVVJRCBrZXkgdGhhdCBpcyBwb3N0Zml4ZWQgdG8gZXZlcnkgc3RvcmUgdG8gaGFuZGxlIHJlc2V0IHN3YXBzXG4gICAgbGV0IHN0YXRlID0gYXdhaXQgdGhpcy5BY3RpdmVEYXRhTW9kZWwuZmluZE9uZSh7IGlkOiBhY3RpdmVEYXRhS2V5IH0pO1xuXG4gICAgaWYgKCFzdGF0ZSkge1xuICAgICAgc3RhdGUgPSBuZXcgdGhpcy5BY3RpdmVEYXRhTW9kZWwoKTtcbiAgICAgIC8vIGFsd2F5cyBzZXQgdGhlIGlkIHRvIHRoZSBhY3RpdmVEYXRhS2V5LCB3ZSBvbmx5IGhhdmUgMSBlbnRyeSBpbiB0aGlzIG1vZGVsIHNvIGl0IHdvcmtzXG4gICAgICBzdGF0ZS5pZCA9IGFjdGl2ZURhdGFLZXk7XG4gICAgfVxuXG4gICAgc3RhdGUua2V5ID0gYWN0aXZlS2V5O1xuICAgIGF3YWl0IHN0YXRlLnNhdmUoKTtcbiAgfVxuXG4gIGJvb2ttYXJrID0gYXN5bmMgKCkgPT4ge1xuICAgIC8vIE9rIHRoaXMgaXMgY29uZnVzaW5nLCBzbyBsZXRzIGV4cGxhaW4gaXQuICBXZSBzaW1wbHkgbmVlZCBhIHNpbmdsZSBlbnRyeSBpbiBhIGNvbGxlY3Rpb24uXG4gICAgLy8gdGh1cyB3ZSBqdXN0IHRhZyB0aGUgaWQgYXMgdGhlIGRlZmF1bHRLZXkgYW5kIHNlYXJjaCB0byBzZWUgaWYgaXQgZXhpc3RzLiAgWW91IG1pZ2h0IGJlXG4gICAgLy8gdGVtcHRlZCB0byB1c2UgdGhpcy5rZXksIGJ1dCB0aGF0J3MgYSBtaXN0YWtlIGFzIHRoYXQncyB3aGF0IGNvbnRyb2xzIHRoZSBtb2RlbC4gIHdlIGFsd2F5c1xuICAgIC8vIHdhbnQgdG8gc3RvcmUgdGhlIHZhbHVlIG9mIG9mIGJvb2ttYXJrcyAoYW5kIHByb2plY3Rpb24gc3RhdGUpIGluIHRoZSBkZWZhdWx0S2V5XG4gICAgdmFyIHN0YXRlID0gYXdhaXQgdGhpcy5Qcm9qZWN0aW9uU3RhdGVNb2RlbC5maW5kT25lKHsgaWQ6IGRlZmF1bHRLZXkgfSk7XG5cbiAgICBpZiAoIXN0YXRlKSB7XG4gICAgICBzdGF0ZSA9IG5ldyB0aGlzLlByb2plY3Rpb25TdGF0ZU1vZGVsKCk7XG4gICAgICAvLyByZW1lbWJlciBhbHdheXMgdXNlIGRlZmF1bHQgS2V5IGZvciBzdG9yaW5nIHRoZSB2YWx1ZSBpbiB0aGUgY29sbGVjdGlvblxuICAgICAgc3RhdGUuaWQgPSBkZWZhdWx0S2V5O1xuICAgIH1cblxuICAgIGlmICghc3RhdGUuYm9va21hcmspIHtcbiAgICAgIHN0YXRlLmJvb2ttYXJrID0gMDtcbiAgICAgIGF3YWl0IHN0YXRlLnNhdmUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RhdGUuYm9va21hcms7XG4gIH1cblxuICBzZXRCb29rbWFyayA9IGFzeW5jIGJvb2ttYXJrID0+IHtcbiAgICBsZXQgc3RhdGUgPSBhd2FpdCB0aGlzLlByb2plY3Rpb25TdGF0ZU1vZGVsLmZpbmRPbmUoeyBpZDogZGVmYXVsdEtleSB9KTtcblxuICAgIGlmICghc3RhdGUpIHtcbiAgICAgIHN0YXRlID0gbmV3IHRoaXMuUHJvamVjdGlvblN0YXRlTW9kZWwoKTtcbiAgICAgIC8vIHJlbWVtYmVyIGFsd2F5cyB1c2UgZGVmYXVsdCBLZXkgZm9yIHN0b3JpbmcgdGhlIHZhbHVlIGluIHRoZSBjb2xsZWN0aW9uXG4gICAgICBzdGF0ZS5pZCA9IGRlZmF1bHRLZXk7XG4gICAgfVxuXG4gICAgc3RhdGUuYm9va21hcmsgPSBib29rbWFyaztcbiAgICBhd2FpdCBzdGF0ZS5zYXZlKCk7XG4gIH1cblxuICByZXNldCA9IGFzeW5jIGtleSA9PiB7XG4gICAgLy8ga2V5IGNvbWluZyBpbiBpcyBhIFVVSUQsIG5vdCB0aGUgZnVsbCBwcmVmaXgga2V5IGZvciB0aGUgcHJvamVjdGlvbiBib29rbWFyayBzdG9yZVxuICAgIGNvbnN0IG5ld1Byb2plY3Rpb25TdGF0ZUtleSA9IGAke2RlZmF1bHRLZXl9LiR7a2V5fWA7XG4gICAgLy8gc3RvcmUgdGhlIG9sZCBtb2RlbCBzbyB3ZSBjYW4gZGVsZXRlIGl0IGFmdGVyIHdlIGhhdmUgdXBkYXRlZCB0aGUgbmV3IG1vZGVsXG4gICAgY29uc3Qgb2xkTW9kZWwgPSB0aGlzLlByb2plY3Rpb25TdGF0ZU1vZGVsO1xuICAgIC8vIHdlIHVwZGF0ZSB0aGUgc2NoZW1hIHRvIHBvaW50IHRvIHRoZSBuZXcga2V5XG4gICAgdGhpcy5Qcm9qZWN0aW9uU3RhdGVNb2RlbCA9IG1vbmdvb3NlLm1vZGVsKG5ld1Byb2plY3Rpb25TdGF0ZUtleSwgUHJvamVjdGlvblN0YXRlU2NoZW1hKTtcbiAgICAvLyBjaGFuZ2UgbW9kZWwga2V5LCB3aGljaCBjcmVhdGVzIGEgbmV3IGNvbGxlY3Rpb24gaW4gZGIuIFdoaWxlIHRoaXMgaXMgYSAuZmluZE9uZUFuZFVwZGF0ZVxuICAgIC8vIGl0IHdpbGwgbmV2ZXIgZmluZCBhbnl0aGluZyBzaW5jZSB0aGlzIGlzIGEgbmV3IG1vZGVsLCB0aHVzIGl0IHdpbGwgY3JlYXRlIGl0IGV2ZXJ5IHRpbWVcbiAgICBhd2FpdCB0aGlzLlByb2plY3Rpb25TdGF0ZU1vZGVsXG4gICAgICAuZmluZE9uZUFuZFVwZGF0ZSh7IGlkOiBkZWZhdWx0S2V5IH0sIHsgYm9va21hcms6IDAgfSwgeyB1cHNlcnQ6IHRydWUgfSk7XG5cbiAgICBvbGRNb2RlbC5jb2xsZWN0aW9uLmRyb3AoKTtcbiAgICAvLyB1c2UgdGhlIG5ldyBwcm9qZWN0aW9uU3RhdGVLZXkgZXZlcnl3aGVyZS5cbiAgICB0aGlzLnByb2plY3Rpb25TdGF0ZUtleSA9IG5ld1Byb2plY3Rpb25TdGF0ZUtleTtcbiAgICAvLyBzYXZlIHRoZSBrZXkgaW4gdGhlIGRhdGFiYXNlIHNvIHdlIGRvbid0IGhhdmUgdG8gcmVidWlsZCB0aGUgZGF0YSBvbiBzdGFydHVwXG4gICAgdGhpcy5zZXRLZXkoa2V5KTtcbiAgfVxufVxuIl19
