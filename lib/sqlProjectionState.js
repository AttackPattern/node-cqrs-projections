"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _mongoose=_interopRequireDefault(require("mongoose"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function asyncGeneratorStep(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=c.apply(e,i);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var defaultKey="sql.projectionState",ProjectionStateSchema=new _mongoose.default.Schema({id:String,bookmark:Number}),activeDataKey="sql.activeKey",ActiveDataSchema=new _mongoose.default.Schema({id:String,key:String}),ProjectionState=function e(){var o=this;_classCallCheck(this,e),_defineProperty(this,"getActiveKey",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ActiveDataModel.findOne({id:activeDataKey});case 2:return(null==(t=e.sent)?void 0:t.key)&&(o.projectionStateKey="".concat(defaultKey,".").concat(null==t?void 0:t.key),o.ProjectionStateModel=_mongoose.default.model(o.key,ProjectionStateSchema)),e.abrupt("return",(null==t?void 0:t.key)||"");case 5:case"end":return e.stop()}},e)}))),_defineProperty(this,"setKey",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ActiveDataModel.findOne({id:activeDataKey});case 2:return(n=e.sent)||((n=new o.ActiveDataModel).id=activeDataKey),n.key=t,e.next=7,n.save();case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),_defineProperty(this,"bookmark",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ProjectionStateModel.findOne({id:defaultKey});case 2:if((t=e.sent)||((t=new o.ProjectionStateModel).id=defaultKey),t.bookmark){e.next=8;break}return t.bookmark=0,e.next=8,t.save();case 8:return e.abrupt("return",t.bookmark);case 9:case"end":return e.stop()}},e)}))),_defineProperty(this,"setBookmark",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.ProjectionStateModel.findOne({id:defaultKey});case 2:return(n=e.sent)||((n=new o.ProjectionStateModel).id=defaultKey),n.bookmark=t,e.next=7,n.save();case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),_defineProperty(this,"reset",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(defaultKey,".").concat(t),r=o.ProjectionStateModel,o.ProjectionStateModel=_mongoose.default.model(n,ProjectionStateSchema),e.next=5,o.ProjectionStateModel.findOneAndUpdate({id:defaultKey},{bookmark:0},{upsert:!0});case 5:r.collection.drop(),o.projectionStateKey=newKey,o.setKey(t);case 8:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),this.projectionStateKey=defaultKey,this.ProjectionStateModel=_mongoose.default.model(defaultKey,ProjectionStateSchema),this.ActiveDataModel=_mongoose.default.model(activeDataKey,ActiveDataSchema)};exports.default=ProjectionState;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNxbFByb2plY3Rpb25TdGF0ZS5qcyJdLCJuYW1lcyI6WyJfbW9uZ29vc2UiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImRlZmF1bHRLZXkiLCJQcm9qZWN0aW9uU3RhdGVTY2hlbWEiLCJtb25nb29zZSIsIlNjaGVtYSIsImlkIiwiU3RyaW5nIiwiYm9va21hcmsiLCJOdW1iZXIiLCJhY3RpdmVEYXRhS2V5IiwiQWN0aXZlRGF0YVNjaGVtYSIsImtleSIsIlByb2plY3Rpb25TdGF0ZSIsIl90aGlzIiwidGhpcyIsIl9jbGFzc0NhbGxDaGVjayIsIl9kZWZpbmVQcm9wZXJ0eSIsIl9hc3luY1RvR2VuZXJhdG9yIiwicmVnZW5lcmF0b3JSdW50aW1lIiwibWFyayIsIkFjdGl2ZURhdGFNb2RlbCIsImZpbmRPbmUiLCJzdGF0ZSIsIl9yZWYyIiwiYWN0aXZlS2V5Iiwic2F2ZSIsIl94IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfY2FsbGVlMyIsIndyYXAiLCJfY29udGV4dDMiLCJwcmV2IiwibmV4dCIsIlByb2plY3Rpb25TdGF0ZU1vZGVsIiwic2VudCIsImFicnVwdCIsInN0b3AiLCJfcmVmNCIsIl9jYWxsZWU0IiwiX2NvbnRleHQ0IiwiX3gyIiwiX3JlZjUiLCJfY2FsbGVlNSIsIm5ld1Byb2plY3Rpb25TdGF0ZUtleSIsIm9sZE1vZGVsIiwiX2NvbnRleHQ1IiwiY29uY2F0IiwibW9kZWwiLCJmaW5kT25lQW5kVXBkYXRlIiwidXBzZXJ0IiwiY29sbGVjdGlvbiIsImRyb3AiLCJwcm9qZWN0aW9uU3RhdGVLZXkiLCJuZXdLZXkiLCJfeDMiXSwibWFwcGluZ3MiOiIyRkFBQSxJQUFBQSxVQUFBQyx1QkFBQUMsUUFBQSxvc0JBRUEsSUFBTUMsV0FBYSxzQkFDYkMsc0JBQXdCLElBQUlDLFVBQUFBLFFBQVNDLE9BQU8sQ0FDNUNDLEdBQUlDLE9BQ0pDLFNBQVVDLFNBR1pDLGNBQWdCLGdCQUNkQyxpQkFBbUIsSUFBSVAsVUFBQUEsUUFB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QUEsRUFLQ2lDLEVBQUFQLEtBQUEsRUFVTlgsRUFBQUcsT0FWTSxLQUFBLEVBQUEsSUFBQSxNQUFBLE9BQUFlLEVBQUFILFNBQUFFLE1BTEQsT0FBQSxTQUFBRSxHQUFBLE9BQUFILEVBQUFYLE1BQUFiLEtBQUFjLFlBQUEsSUFBQVosZ0JBQUFGLEtBQUEsUUFBQSxXQUFBLElBQUE0QixFQUFBekIsa0JBQUFDLG1CQUFBQyxLQWVMLFNBQUF3QixFQUFBaEMsR0FBQSxJQUFBaUMsRUFBQUMsRUFBQSxPQUFBM0IsbUJBQUFZLEtBQUEsU0FBQWdCLEdBQUEsT0FBQSxPQUFBQSxFQUFBZCxLQUFBYyxFQUFBYixNQUFBLEtBQUEsRUFBQSxPQUFBVyxFQUFBLEdBQUFHLE9BQUE5QyxXQUFBLEtBQUE4QyxPQUFBcEMsR0FFMENOLEVBQUlJLEVBQUFBLHFCQW9EckRJLEVBQUtxQixxQkFBdUIvQixVQUFBQSxRQUFTNkMsTUFBTUosRUFBdUIxQyx1QkF0RDNENEMsRUFBQWIsS0FBQSxFQXlERHBCLEVBQUtxQixxQkFyRFhlLGlCQUFBLENBQVk1QyxHQUFBSixZQUFBLENBQUFNLFNBQUEsR0FBQSxDQUFBMkMsUUFBQSxJQUpMLEtBQUEsRUE0RFBMLEVBQVNNLFdBQVdDLE9BcERuQnZDLEVBQUF3QyxtQkFBQUMsT0FFRGhDLEVBQUFBLE9BQUFBLEdBVk8sS0FBQSxFQUFBLElBQUEsTUFBQSxPQUFBd0IsRUFBQVQsU0FBQU0sTUFmSyxPQUFBLFNBQUFZLEdBQUEsT0FBQWIsRUFBQWYsTUFBQWIsS0FBQWMsWUFBQSxJQUNaZCxLQUFLdUMsbUJBQXFCcEQsV0FDMUJhLEtBQUtvQixxQkFBdUIvQixVQUFBQSxRQUFTNkMsTUFBTS9DLFdBQVlDLHVCQUN2RFksS0FBS00sZ0JBQWtCakIsVUFBQUEsUUFBUzZDLE1BQU12QyxjQUFlQyIsImZpbGUiOiJzcWxQcm9qZWN0aW9uU3RhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuXG5jb25zdCBkZWZhdWx0S2V5ID0gJ3NxbC5wcm9qZWN0aW9uU3RhdGUnO1xuY29uc3QgUHJvamVjdGlvblN0YXRlU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgICBpZDogU3RyaW5nLFxuICAgICAgYm9va21hcms6IE51bWJlclxuICB9KTtcblxubGV0IGFjdGl2ZURhdGFLZXkgPSAnc3FsLmFjdGl2ZUtleSc7XG5jb25zdCBBY3RpdmVEYXRhU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgaWQ6IFN0cmluZyxcbiAgICBrZXk6IFN0cmluZ1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2plY3Rpb25TdGF0ZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMucHJvamVjdGlvblN0YXRlS2V5ID0gZGVmYXVsdEtleTtcbiAgICB0aGlzLlByb2plY3Rpb25TdGF0ZU1vZGVsID0gbW9uZ29vc2UubW9kZWwoZGVmYXVsdEtleSwgUHJvamVjdGlvblN0YXRlU2NoZW1hKTtcbiAgICB0aGlzLkFjdGl2ZURhdGFNb2RlbCA9IG1vbmdvb3NlLm1vZGVsKGFjdGl2ZURhdGFLZXksIEFjdGl2ZURhdGFTY2hlbWEpO1xuICB9XG4gIGdldEFjdGl2ZUtleSA9IGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBzdGF0ZSA9IGF3YWl0IHRoaXMuQWN0aXZlRGF0YU1vZGVsLmZpbmRPbmUoeyBpZDogYWN0aXZlRGF0YUtleSB9KTtcbiAgICAgIC8vIGNoYW5nZSBvdmVyIFByb2plY3Rpb25TdGF0ZSBrZXkgYXMgd2VsbC5cbiAgICAgIGlmIChzdGF0ZT8ua2V5KSB7XG4gICAgICAgIHRoaXMucHJvamVjdGlvblN0YXRlS2V5ID0gYCR7ZGVmYXVsdEtleX0uJHtzdGF0ZT8ua2V5fWA7XG4gICAgICAgIHRoaXMuUHJvamVjdGlvblN0YXRlTW9kZWwgPSBtb25nb29zZS5tb2RlbCh0aGlzLmtleSwgUHJvamVjdGlvblN0YXRlU2NoZW1hKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdGF0ZT8ua2V5IHx8ICcnO1xuICB9XG5cbiAgc2V0S2V5ID0gYXN5bmMgYWN0aXZlS2V5ID0+IHtcbiAgICAvLyB0aGlzIGlzIHVzZWQgdG8gc3RvcmUgdGhlIFVVSUQga2V5IHRoYXQgaXMgcG9zdGZpeGVkIHRvIGV2ZXJ5IHN0b3JlIHRvIGhhbmRsZSByZXNldCBzd2Fwc1xuICAgIGxldCBzdGF0ZSA9IGF3YWl0IHRoaXMuQWN0aXZlRGF0YU1vZGVsLmZpbmRPbmUoeyBpZDogYWN0aXZlRGF0YUtleSB9KTtcblxuICAgIGlmICghc3RhdGUpIHtcbiAgICAgIHN0YXRlID0gbmV3IHRoaXMuQWN0aXZlRGF0YU1vZGVsKCk7XG4gICAgICAvLyBhbHdheXMgc2V0IHRoZSBpZCB0byB0aGUgYWN0aXZlRGF0YUtleSwgd2Ugb25seSBoYXZlIDEgZW50cnkgaW4gdGhpcyBtb2RlbCBzbyBpdCB3b3Jrc1xuICAgICAgc3RhdGUuaWQgPSBhY3RpdmVEYXRhS2V5O1xuICAgIH1cblxuICAgIHN0YXRlLmtleSA9IGFjdGl2ZUtleTtcbiAgICBhd2FpdCBzdGF0ZS5zYXZlKCk7XG4gIH1cblxuICBib29rbWFyayA9IGFzeW5jICgpID0+IHtcbiAgICAvLyBPayB0aGlzIGlzIGNvbmZ1c2luZywgc28gbGV0cyBleHBsYWluIGl0LiAgV2Ugc2ltcGx5IG5lZWQgYSBzaW5nbGUgZW50cnkgaW4gYSBjb2xsZWN0aW9uLlxuICAgIC8vIHRodXMgd2UganVzdCB0YWcgdGhlIGlkIGFzIHRoZSBkZWZhdWx0S2V5IGFuZCBzZWFyY2ggdG8gc2VlIGlmIGl0IGV4aXN0cy4gIFlvdSBtaWdodCBiZVxuICAgIC8vIHRlbXB0ZWQgdG8gdXNlIHRoaXMua2V5LCBidXQgdGhhdCdzIGEgbWlzdGFrZSBhcyB0aGF0J3Mgd2hhdCBjb250cm9scyB0aGUgbW9kZWwuICB3ZSBhbHdheXNcbiAgICAvLyB3YW50IHRvIHN0b3JlIHRoZSB2YWx1ZSBvZiBvZiBib29rbWFya3MgKGFuZCBwcm9qZWN0aW9uIHN0YXRlKSBpbiB0aGUgZGVmYXVsdEtleVxuICAgIHZhciBzdGF0ZSA9IGF3YWl0IHRoaXMuUHJvamVjdGlvblN0YXRlTW9kZWwuZmluZE9uZSh7IGlkOiBkZWZhdWx0S2V5IH0pO1xuXG4gICAgaWYgKCFzdGF0ZSkge1xuICAgICAgc3RhdGUgPSBuZXcgdGhpcy5Qcm9qZWN0aW9uU3RhdGVNb2RlbCgpO1xuICAgICAgLy8gcmVtZW1iZXIgYWx3YXlzIHVzZSBkZWZhdWx0IEtleSBmb3Igc3RvcmluZyB0aGUgdmFsdWUgaW4gdGhlIGNvbGxlY3Rpb25cbiAgICAgIHN0YXRlLmlkID0gZGVmYXVsdEtleTtcbiAgICB9XG5cbiAgICBpZiAoIXN0YXRlLmJvb2ttYXJrKSB7XG4gICAgICBzdGF0ZS5ib29rbWFyayA9IDA7XG4gICAgICBhd2FpdCBzdGF0ZS5zYXZlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YXRlLmJvb2ttYXJrO1xuICB9XG5cbiAgc2V0Qm9va21hcmsgPSBhc3luYyBib29rbWFyayA9PiB7XG4gICAgbGV0IHN0YXRlID0gYXdhaXQgdGhpcy5Qcm9qZWN0aW9uU3RhdGVNb2RlbC5maW5kT25lKHsgaWQ6IGRlZmF1bHRLZXkgfSk7XG5cbiAgICBpZiAoIXN0YXRlKSB7XG4gICAgICBzdGF0ZSA9IG5ldyB0aGlzLlByb2plY3Rpb25TdGF0ZU1vZGVsKCk7XG4gICAgICAvLyByZW1lbWJlciBhbHdheXMgdXNlIGRlZmF1bHQgS2V5IGZvciBzdG9yaW5nIHRoZSB2YWx1ZSBpbiB0aGUgY29sbGVjdGlvblxuICAgICAgc3RhdGUuaWQgPSBkZWZhdWx0S2V5O1xuICAgIH1cblxuICAgIHN0YXRlLmJvb2ttYXJrID0gYm9va21hcms7XG4gICAgYXdhaXQgc3RhdGUuc2F2ZSgpO1xuICB9XG5cbiAgcmVzZXQgPSBhc3luYyBrZXkgPT4ge1xuICAgIC8vIGtleSBjb21pbmcgaW4gaXMgYSBVVUlELCBub3QgdGhlIGZ1bGwgcHJlZml4IGtleSBmb3IgdGhlIHByb2plY3Rpb24gYm9va21hcmsgc3RvcmVcbiAgICBjb25zdCBuZXdQcm9qZWN0aW9uU3RhdGVLZXkgPSBgJHtkZWZhdWx0S2V5fS4ke2tleX1gO1xuICAgIC8vIHN0b3JlIHRoZSBvbGQgbW9kZWwgc28gd2UgY2FuIGRlbGV0ZSBpdCBhZnRlciB3ZSBoYXZlIHVwZGF0ZWQgdGhlIG5ldyBtb2RlbFxuICAgIGNvbnN0IG9sZE1vZGVsID0gdGhpcy5Qcm9qZWN0aW9uU3RhdGVNb2RlbDtcbiAgICAvLyB3ZSB1cGRhdGUgdGhlIHNjaGVtYSB0byBwb2ludCB0byB0aGUgbmV3IGtleVxuICAgIHRoaXMuUHJvamVjdGlvblN0YXRlTW9kZWwgPSBtb25nb29zZS5tb2RlbChuZXdQcm9qZWN0aW9uU3RhdGVLZXksIFByb2plY3Rpb25TdGF0ZVNjaGVtYSk7XG4gICAgLy8gY2hhbmdlIG1vZGVsIGtleSwgd2hpY2ggY3JlYXRlcyBhIG5ldyBjb2xsZWN0aW9uIGluIGRiLiBXaGlsZSB0aGlzIGlzIGEgLmZpbmRPbmVBbmRVcGRhdGVcbiAgICAvLyBpdCB3aWxsIG5ldmVyIGZpbmQgYW55dGhpbmcgc2luY2UgdGhpcyBpcyBhIG5ldyBtb2RlbCwgdGh1cyBpdCB3aWxsIGNyZWF0ZSBpdCBldmVyeSB0aW1lXG4gICAgYXdhaXQgdGhpcy5Qcm9qZWN0aW9uU3RhdGVNb2RlbFxuICAgICAgLmZpbmRPbmVBbmRVcGRhdGUoeyBpZDogZGVmYXVsdEtleSB9LCB7IGJvb2ttYXJrOiAwIH0sIHsgdXBzZXJ0OiB0cnVlIH0pO1xuXG4gICAgb2xkTW9kZWwuY29sbGVjdGlvbi5kcm9wKCk7XG4gICAgLy8gdXNlIHRoZSBuZXcgcHJvamVjdGlvblN0YXRlS2V5IGV2ZXJ5d2hlcmUuXG4gICAgdGhpcy5wcm9qZWN0aW9uU3RhdGVLZXkgPSBuZXdLZXk7XG4gICAgLy8gc2F2ZSB0aGUga2V5IGluIHRoZSBkYXRhYmFzZSBzbyB3ZSBkb24ndCBoYXZlIHRvIHJlYnVpbGQgdGhlIGRhdGEgb24gc3RhcnR1cFxuICAgIHRoaXMuc2V0S2V5KGtleSk7XG4gIH1cbn1cbiJdfQ==
