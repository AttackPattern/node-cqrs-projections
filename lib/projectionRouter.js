"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _objectWithoutProperties(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(o[r]=t[r]);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(t);for(n=0;n<u.length;n++)r=u[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}function _asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){function i(t,e){try{var r=a[t](e),i=r.value}catch(t){return void o(t)}r.done?n(i):Promise.resolve(i).then(u,c)}function u(t){i("next",t)}function c(t){i("throw",t)}var a=t.apply(e,r);u()})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(e&&("object"===_typeof(e)||"function"==typeof e))return e;if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _koaRouter=_interopRequireDefault(require("koa-router")),ProjectionRouter=function(t){function e(t){var r;return _classCallCheck(this,e),r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),Object.entries(t).map(function(t){var e=t[0],n=t[1];n.forEach(function(t){r.get("/".concat(e,"/").concat(t.name()),function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(n,o){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.get(n.query,n.$identity);case 3:return i=r.sent,Array.isArray(i)&&i.forEach(function(t){delete t._id,delete t.__v}),n.status=200,r.abrupt("return",n.body=i);case 9:return r.prev=9,r.t0=r.catch(0),console.log("Failed loading projection /".concat(e),r.t0),r.abrupt("return",o());case 13:case"end":return r.stop()}},r,this,[[0,9]])}));return function(t,e){return r.apply(this,arguments)}}()).get("/".concat(e,"/").concat(t.name(),"/:id"),function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(n,o){var i,u,c,a,s,f,l;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=n.$identity,u=n.params.id,r.next=5,t.getById(u,n.$identity);case 5:c=r.sent,a=Array.isArray(c)&&c.length?c[0]:c,s=a._id,f=a.__v,l=_objectWithoutProperties(a,["_id","__v"]),n.body=l,n.status=200,r.next=15;break;case 11:return r.prev=11,r.t0=r.catch(0),console.log("Failed loading projection /".concat(e),r.t0),r.abrupt("return",o());case 15:case"end":return r.stop()}},r,this,[[0,11]])}));return function(t,e){return r.apply(this,arguments)}}())})}),r}return _inherits(e,t),e}(_koaRouter.default);exports.default=ProjectionRouter;
//# sourceMappingURL=maps/projectionRouter.js.map
